kind: Secret
apiVersion: v1
metadata:
  name: $QMpre-uniform-cluster-cert
  namespace: $TARGET_NAMESPACE
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURDVENDQWZHZ0F3SUJBZ0lVR0tiaE5ZWXJMZVdqUFBVTlp5RldJTjJQWExRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0ZERVNNQkFHQTFVRUF3d0piRzlqWVd4b2IzTjBNQjRYRFRJd01ERXdOakV3TURjeU4xb1hEVE13TURFdwpNekV3TURjeU4xb3dGREVTTUJBR0ExVUVBd3dKYkc5allXeG9iM04wTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGCkFBT0NBUThBTUlJQkNnS0NBUUVBem5EbkpGaHhFMGRMTFdhOUZZQlBvakZNdWVSL1pESXJZTEE0OGFWYVNNYU8KRjhNT0o0RGpHQWJ1L0UwbjlIR3JxSXI5bnRSc29SZkhjMFdhcExDcFdwdXdnWlBFSXVXR25MS2xjdVJtYnRVVApUUlkvQkhITEtrVUFncnlCUXVqZFh2RFRobnltYXZCUGpLM1QxZlZFMGNFT1lHQTlHanJYU0IzT2hQR1pHQmxOCmM5NXppZEZSOVZyWHQwRFJDVkFrNjRmYlRoa3V2SDh1TkV1VGFodlVFOVJIZmRzajJzZU81S0k3bmdYMG1IUUIKcUlMdVAzcGEreU1WNUc4TlBaalN4U0IwQjNlS3YraUNjV2hSdTZSRmIyZmNmZXpnbm1TcFJYVTUwS1lxV1piZApvc0czaFFxU1JRUTJZUmR5NzZaMGJKb3FGM3N0aGJJaTZ5TmYvTVQ5ZndJREFRQUJvMU13VVRBZEJnTlZIUTRFCkZnUVVIQlBGY0FyTy9ZUmxiZ0tobmkxSVdnS0Z5VEF3SHdZRFZSMGpCQmd3Rm9BVUhCUEZjQXJPL1lSbGJnS2gKbmkxSVdnS0Z5VEF3RHdZRFZSMFRBUUgvQkFVd0F3RUIvekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBWkZ6SQpaLzZOay9TQmY0WXJHdVdNSzVjTTRLdldjWUdXQWlndTZ1TzZvV2VUVmdYamtGbE9GZ2RHRVhpSjFZNi9mRFBCCitaMVE0SERMYm1hbGE1aXRqeVhXbWFsRTFFOHR2bThGMDA5ZEFPL0oxUmNyS1VZcUFKbGJQNTZtbmt1QmtqZE0KYzAyMkhXOTd0RUpkYXViTlF2ZWJraDhZK1loUGVkV242ZmFtMVM1S2cwYUlVUWRKd0FuZDlCb2hLVkk3SHFFZgpoUktDYmJFZzNySXlSS0FLdk5DRXlvMjY4b3VIcll3Mi9WMEhMU0VnWEU3UTFxWTVKaXF6Y3Iyb0EvU2xZdGZwCnZYZFhKajA3OGJ1N3hrS2FxZkxpN3FTSzdjSVRjWjNWcldGOWZCbEh5MVV1K2V1NVNhN29udFR2MktON2Joc1QKNGczVTlMdWR2L01xTE5EWDVnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRRE9jT2NrV0hFVFIwc3QKWnIwVmdFK2lNVXk1NUg5a01pdGdzRGp4cFZwSXhvNFh3dzRuZ09NWUJ1NzhUU2YwY2F1b2l2MmUxR3loRjhkegpSWnFrc0tsYW03Q0JrOFFpNVlhY3NxVnk1R1p1MVJOTkZqOEVjY3NxUlFDQ3ZJRkM2TjFlOE5PR2ZLWnE4RStNCnJkUFY5VVRSd1E1Z1lEMGFPdGRJSGM2RThaa1lHVTF6M25PSjBWSDFXdGUzUU5FSlVDVHJoOXRPR1M2OGZ5NDAKUzVOcUc5UVQxRWQ5MnlQYXg0N2tvanVlQmZTWWRBR29ndTQvZWxyN0l4WGtidzA5bU5MRklIUUhkNHEvNklKeAphRkc3cEVWdlo5eDk3T0NlWktsRmRUblFwaXBabHQyaXdiZUZDcEpGQkRaaEYzTHZwblJzbWlvWGV5MkZzaUxyCkkxLzh4UDEvQWdNQkFBRUNnZ0VBQ0czcndqd3FRZE5EYXBNclhWbGo1d2VFVG9MYUFNbGJwQk1PQUMvMFE4eDMKdU5pcUYwclgrdjh0ZXZmYmpjdW1hcmRpSzc0WXdXc3JKYlhOM3JPbjlwOHMwZDJxd0pJR3NSZEtVaXFwVkJVMwpPSXFVQUNaMVdVQ0FDTmFSb0ozSmpEcmhLRGltd3U4VkVIVjRsTi95ODIyaW5LVFJXZVRWTFlpcUNodWpXS3g5CkNvUU9qeFpkZFFxV0xNbEtndFRQOGUxSTI2MmNUbVhzVzhhSWQ4dDVpWUZmcFc2OHpLTzZqSmRVWktpdnE2MkcKc3hqYnF5Kzk1SitqbzBLeWUybzN0M2NFempJUEk4L1hhRmllTlFFTUZtRWVlVzVSNE1iZ3VNblpocTBVV1BzSwpWdHE0Ukp2OW02aC9RWGlqMGVCY281Rnp2MFB5RHZtUFkrZWUwT1plQVFLQmdRRHBQUm9wanpMYjhFRnUzcnU2Cktyc1BNYzUvbUc4S1pmY0NGejdjSHRQdTJEQzZxTytpRXhkVk5xZ2h6ZGtLK05kalFGUGNmdlRQZXhCOWhsWUEKN0NtOE1QRkxSNUhNditFL3BSQm5UNzVLZHdhT2NjT21ibFNGSE1LSjhJVXZld3daaERhQWFFWlNmQld0TU9GdwpKa0FrTDdMTWxkL0Ixbk9LaDM5YmR1ZEpRUUtCZ1FEaWxsT3ZGVkVjaUxyM28yR1JzUnhIK1lMQkJjbUZpSEo2CngzQ1JNQjRPMldZMjJPYXpsZVJZUXdqdU1PS2xGNmNiR0VBR1JKaVRIbGo2MFE0cXVwbERrbVJTdWVJcnBRMTEKU3A1MnMranY3WXpZdFpxUG00UzFtaG9xcU1iRDg2V2VEZnp6RUIweWJPUk8xZW04NXRqZStoN3FvN0Y5QWUrSwplU29TUDduV3Z3S0JnQUpTQlV5Y2pCajhEdXFYZEs2cGRpcjBoK1ZsRXRXN3BmVnpYY0M2M2NqbWhiV1ZzS3lnCkcvOVJCK011TlJhUzJ6RzFsaC8vYzFnTkZXRHFVVGk1SU1FcWkzd0FQa2NYTVpwOGZlbEpOYzl2MTdUYkZPTTIKL2NoRlBQbzZWbGplbElROGVINVdpenlPMTNoZG9DQ0pnT0hiUjZBWmJaeDBFYm96RnVWR0RZOEJBb0dBUCs1QQpRRWNZY3ArVmVTZU04T2x5M0UvbTk0VWxmZHFveWtHWlhpMmdYWG96WDhoRkYyaDBXLzdWOXphdHkvem5kanFhClhlcGV6aXVpMlduQXdJZVRsTUFxTkRra09rSkFrTlp6N1hRSGhpS1ZPZFBMZnpkVzgxSStqY2kvQkN5cmp2UE4KYWRzakVjWXRpSnpNYlRNSS82aThybUZ2UTZFWE1BL05zZ1p1N2NzQ2dZRUFpN2RWYzhkNmNUUVFKR05HL0l4Vwo2d1dJN1U3V094OTNVTlFEZGVyQUhNeFRBMXRKbHdTRmtNUzYrWXAvZzU0K0tTQWZLTWw4eDVUTnRxM1lpUEdiCkozOGtVU2lxV2VudFYzeExMVmJMRTRUYXgxbkptK0ZFNDV4VWxwYjJyTU5kYjFuOFpOdkVrTTJsRElUMHBKOWUKU3EvWkZXMG1jSGdjVWRpdm93WHJLNVE9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
type: Opaque
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: $QMnamea-uniform-cluster-mqsc-1
  namespace: $TARGET_NAMESPACE
data:
  disablesecurity.mqsc: |-
    *##########################################################################
    * Compulsory section for full repository
    *##########################################################################
    ALTER QMGR REPOS($UNICLUS)
    define channel($TOCLUSa) chltype(clusrcvr) trptype(tcp) conname('$CONNAMEa(1414)') cluster($UNICLUS) replace
    define channel($TOCLUSb) chltype(CLUSSDR) trptype(tcp) conname('$CONNAMEb(1414)') cluster($UNICLUS) replace
    *
    *##########################################################################
    * Configuration for all queue managers
    *##########################################################################
    define QL(APPQ) cluster($UNICLUS) defbind(notfixed) clwluseq(any) maxdepth(99999999) replace
    define QL(APPQ2) cluster($UNICLUS) defbind(notfixed) clwluseq(any) maxdepth(99999999) replace
    define channel($TOCLUSc) chltype(CLUSSDR) trptype(tcp) conname('$CONNAMEc(1414)') cluster($UNICLUS) replace
    DEFINE CHANNEL($CHANNELa) CHLTYPE(SVRCONN) TRPTYPE(TCP) SSLCAUTH(OPTIONAL) SSLCIPH('ANY_TLS12_OR_HIGHER') replace
    DEFINE CHANNEL(TO_$UNICLUS) CHLTYPE(SVRCONN) TRPTYPE(TCP) SSLCAUTH(OPTIONAL) SSLCIPH('ANY_TLS12_OR_HIGHER') replace
    ALTER QMGR CHLAUTH(DISABLED)
    ALTER AUTHINFO('SYSTEM.DEFAULT.AUTHINFO.IDPWOS') AUTHTYPE(IDPWOS) ADOPTCTX(YES) CHCKCLNT(OPTIONAL) CHCKLOCL(OPTIONAL) AUTHENMD(OS)
    REFRESH SECURITY TYPE(CONNAUTH)
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: $QMnamea-uniform-cluster-ini-1
  namespace: $TARGET_NAMESPACE
data:
  uniformcluster.ini: |-
    TuningParameters:
       UniformClusterName=$UNICLUS
---
apiVersion: mq.ibm.com/v1beta1
kind: QueueManager
metadata:
  name: $QMnamea
spec:
  version: $VERSION
  license:
    accept: true
    license: L-RJON-CD3JKX
    use: "NonProduction"
  pki:
    keys:
    - name: default
      secret:
        secretName: $QMpre-uniform-cluster-cert
        items:
          - tls.key
          - tls.crt
  web:
    enabled: true
  securityContext:
    supplementalGroups: [99]
  queueManager:
    availability:
      type: SingleInstance
    storage:
      persistedData:
        enabled: true
        class: $SC
      queueManager:
        enabled: true
        class: $SC
      recoveryLogs:
        enabled: true
        class: $SC
    securityContext:
      supplementalGroups: [99]
    mqsc:
      - configMap:
          name: $QMnamea-uniform-cluster-mqsc-1
          items:
            - disablesecurity.mqsc
    ini:
      - configMap:
          name: $QMnamea-uniform-cluster-ini-1
          items:
            - uniformcluster.ini
  template:
    pod:
      containers:
        - env:
            - name: MQSNOAUT
              value: 'yes'
          name: qmgr
---
kind: Route
apiVersion: route.openshift.io/v1
metadata:
  name: mq-traffic-mq-$QMnamea-ibm-mq-qm
  namespace: $TARGET_NAMESPACE
spec:
  host: $CHANNELa.chl.mq.ibm.com
  to:
    kind: Service
    name: $SERVICEa
  port:
    targetPort: 1414
  tls:
    termination: passthrough
  wildcardPolicy: None
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: $QMnameb-uniform-cluster-mqsc-2
  namespace: $TARGET_NAMESPACE
data:
  disablesecurity.mqsc: |-
    *##########################################################################
    * Compulsory section for full repository
    *##########################################################################
    ALTER QMGR REPOS($UNICLUS)
    define channel($TOCLUSb) chltype(clusrcvr) trptype(tcp) conname('$CONNAMEb(1414)') cluster($UNICLUS) replace
    define channel($TOCLUSa) chltype(CLUSSDR) trptype(tcp) conname('$CONNAMEa(1414)') cluster($UNICLUS) replace
    *
    *##########################################################################
    * Configuration for all queue managers
    *##########################################################################
    define QL(APPQ) cluster($UNICLUS) defbind(notfixed) clwluseq(any) maxdepth(99999999) replace
    define QL(APPQ2) cluster($UNICLUS) defbind(notfixed) clwluseq(any) maxdepth(99999999) replace
    define channel($TOCLUSc) chltype(CLUSSDR) trptype(tcp) conname('$CONNAMEc(1414)') cluster($UNICLUS) replace
    DEFINE CHANNEL($CHANNELb) CHLTYPE(SVRCONN) TRPTYPE(TCP) SSLCAUTH(OPTIONAL) SSLCIPH('ANY_TLS12_OR_HIGHER')
    DEFINE CHANNEL(TO_$UNICLUS) CHLTYPE(SVRCONN) TRPTYPE(TCP) SSLCAUTH(OPTIONAL) SSLCIPH('ANY_TLS12_OR_HIGHER')
    ALTER QMGR CHLAUTH(DISABLED)
    ALTER AUTHINFO('SYSTEM.DEFAULT.AUTHINFO.IDPWOS') AUTHTYPE(IDPWOS) ADOPTCTX(YES) CHCKCLNT(OPTIONAL) CHCKLOCL(OPTIONAL) AUTHENMD(OS)
    REFRESH SECURITY TYPE(CONNAUTH)
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: $QMnameb-uniform-cluster-ini-2
  namespace: $TARGET_NAMESPACE
data:
  uniformcluster.ini: |-
    TuningParameters:
       UniformClusterName=$UNICLUS
---
apiVersion: mq.ibm.com/v1beta1
kind: QueueManager
metadata:
  name: $QMnameb
spec:
  version: $VERSION
  license:
    accept: true
    license: L-RJON-CD3JKX
    use: "NonProduction"
  pki:
    keys:
    - name: default
      secret:
        secretName: $QMpre-uniform-cluster-cert
        items:
          - tls.key
          - tls.crt
  web:
    enabled: true
  securityContext:
    supplementalGroups: [99]
  queueManager:
    availability:
      type: SingleInstance
    storage:
      persistedData:
        enabled: true
        class: $SC
      queueManager:
        enabled: true
        class: $SC
      recoveryLogs:
        enabled: true
        class: $SC
    securityContext:
      supplementalGroups: [99]
    mqsc:
      - configMap:
          name: $QMnameb-uniform-cluster-mqsc-2
          items:
            - disablesecurity.mqsc
    ini:
      - configMap:
          name: $QMnameb-uniform-cluster-ini-2
          items:
            - uniformcluster.ini
  template:
    pod:
      containers:
        - env:
            - name: MQSNOAUT
              value: 'yes'
          name: qmgr
---
kind: Route
apiVersion: route.openshift.io/v1
metadata:
  name: mq-traffic-mq-$QMnameb-ibm-mq-qm
  namespace: $TARGET_NAMESPACE
spec:
  host: $CHANNELb.chl.mq.ibm.com
  to:
    kind: Service
    name: $SERVICEb
  port:
    targetPort: 1414
  tls:
    termination: passthrough
  wildcardPolicy: None
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: $QMnamec-uniform-cluster-mqsc-3
  namespace: $TARGET_NAMESPACE
data:
  disablesecurity.mqsc: |
    *##########################################################################
    * Configuration for all queue managers
    *##########################################################################
    define QL(APPQ) cluster($UNICLUS) defbind(notfixed) clwluseq(any) maxdepth(99999999) replace
    define QL(APPQ2) cluster($UNICLUS) defbind(notfixed) clwluseq(any) maxdepth(99999999) replace
    define channel($TOCLUSc) chltype(clusrcvr) trptype(tcp) conname('$CONNAMEc(1414)') cluster($UNICLUS) replace
    define channel($TOCLUSb) chltype(CLUSSDR) trptype(tcp) conname('$CONNAMEb(1414)') cluster($UNICLUS) replace
    define channel($TOCLUSa) chltype(CLUSSDR) trptype(tcp) conname('$CONNAMEa(1414)') cluster($UNICLUS) replace
    DEFINE CHANNEL($CHANNELc) CHLTYPE(SVRCONN) TRPTYPE(TCP) SSLCAUTH(OPTIONAL) SSLCIPH('ANY_TLS12_OR_HIGHER')
    DEFINE CHANNEL(TO_$UNICLUS) CHLTYPE(SVRCONN) TRPTYPE(TCP) SSLCAUTH(OPTIONAL) SSLCIPH('ANY_TLS12_OR_HIGHER')
    ALTER QMGR CHLAUTH(DISABLED)
    ALTER AUTHINFO('SYSTEM.DEFAULT.AUTHINFO.IDPWOS') AUTHTYPE(IDPWOS) ADOPTCTX(YES) CHCKCLNT(OPTIONAL) CHCKLOCL(OPTIONAL) AUTHENMD(OS)
    REFRESH SECURITY TYPE(CONNAUTH)
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: $QMnamec-uniform-cluster-ini-3
  namespace: $TARGET_NAMESPACE
data:
  uniformcluster.ini: |-
    TuningParameters:
       UniformClusterName=$UNICLUS
---
apiVersion: mq.ibm.com/v1beta1
kind: QueueManager
metadata:
  name: $QMnamec
spec:
  version: $VERSION
  license:
    accept: true
    license: L-RJON-CD3JKX
    use: "NonProduction"
  pki:
    keys:
    - name: default
      secret:
        secretName: $QMpre-uniform-cluster-cert
        items:
          - tls.key
          - tls.crt
  web:
    enabled: true
  securityContext:
    supplementalGroups: [99]
  queueManager:
    availability:
      type: SingleInstance
    storage:
      persistedData:
        enabled: true
        class: $SC
      queueManager:
        enabled: true
        class: $SC
      recoveryLogs:
        enabled: true
        class: $SC
    securityContext:
      supplementalGroups: [99]
    mqsc:
      - configMap:
          name: $QMnamec-uniform-cluster-mqsc-3
          items:
            - disablesecurity.mqsc
    ini:
      - configMap:
          name: $QMnamec-uniform-cluster-ini-3
          items:
            - uniformcluster.ini
  template:
    pod:
      containers:
        - env:
            - name: MQSNOAUT
              value: 'yes'
          name: qmgr
---
kind: Route
apiVersion: route.openshift.io/v1
metadata:
  name: mq-traffic-mq-$QMnamec-ibm-mq-qm
  namespace: $TARGET_NAMESPACE
spec:
  host: $CHANNELc.chl.mq.ibm.com
  to:
    kind: Service
    name: $SERVICEc
  port:
    targetPort: 1414
  tls:
    termination: passthrough
  wildcardPolicy: None
